@import './styles/mode-selector.css';
@import './styles/classic-mode.css';

:root {
  --neon-pink: #ff00ff;
  --neon-blue: #00fff7;
  --neon-green: #39ff14;
  --neon-red: #ff3333;
  --neon-gold: #ffd700;
  --panel-bg: rgba(10, 10, 25, 0.98);
  --grey-muted: #555555;
  --grey-dark: #222222;
  font-size: 16px;
}

@media (max-height: 720px) {
  :root {
    font-size: 14px;
  }
}

@media (max-height: 500px) {
  :root {
    font-size: 11px;
  }
}

@media (max-width: 800px) {
  :root {
    font-size: 13px;
  }
}

* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  background: #000;
  overflow: hidden;
  font-family: 'JetBrains Mono', monospace;
  user-select: none;
  color: #fff;
}

#game-container {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #06060a;
  overflow: hidden;
}

canvas {
  width: 100%;
  height: 100%;
  max-width: 177.78vh;
  /* 16:9 ratio */
  max-height: 56.25vw;
  /* 9:16 inverse */
  object-fit: contain;
  background: #000;
  box-shadow: 0 0 5rem rgba(0, 0, 0, 1);
  border: 1px solid #111;
  z-index: 1;
  touch-action: none;
}

.ui-layer {
  position: absolute;
  /* Match canvas scaling perfectly */
  width: 100%;
  height: 100%;
  max-width: 177.78vh;
  max-height: 56.25vw;
  pointer-events: none;
  z-index: 10;
  display: flex;
  flex-direction: column;
}

@media (max-aspect-ratio: 16/9) {
  .ui-layer {
    width: 100vw;
    height: 56.25vw;
    /* maintain 16:9 */
  }
}

@media (min-aspect-ratio: 16/9) {
  .ui-layer {
    height: 100vh;
    width: 177.78vh;
    /* maintain 16:9 */
  }
}

/* HUD POSITIONING */
#top-hud {
  position: absolute;
  top: 1.5rem;
  left: 2rem;
  right: 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  pointer-events: none;
  z-index: 100;
}

#coin-display {
  flex: 1;
  color: var(--neon-gold);
  font-size: 1.1rem;
  text-shadow: 0 0 10px var(--neon-gold);
  font-weight: 700;
  height: 2.2rem;
  display: flex;
  align-items: center;
  pointer-events: auto;
}

#score-container {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  z-index: 101;
}

#score {
  color: var(--neon-blue);
  font-size: 2.2rem;
  text-shadow: 0 0 15px var(--neon-blue);
  font-weight: 950;
  line-height: 1;
}

#action-buttons {
  flex: 1;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 1rem;
  pointer-events: auto;
}

.btn-icon {
  width: 2.2rem;
  height: 2.2rem;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid var(--neon-blue);
  border-radius: 0.5rem;
  color: var(--neon-blue);
  font-size: 1rem;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: 0.2s;
}

.btn-icon:hover {
  background: rgba(0, 255, 247, 0.1);
  border-color: var(--neon-blue);
  color: var(--neon-blue);
  text-shadow: 0 0 3px var(--neon-blue);
  box-shadow: 0 0 8px var(--neon-blue), inset 0 0 3px var(--neon-blue);
  transform: scale(1.1);
}

/* NITRO / DASH HUD (Disabled Dash button, kept Nitro bar) */
#energy-bar-hud {
  position: absolute;
  bottom: 0.25rem;
  left: 1.5rem;
  width: 10rem;
}

#energy-label {
  font-size: 0.5rem;
  color: #fff;
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 0.2rem;
  display: block;
}

#energy-container {
  height: 0.5rem;
  background: rgba(0, 0, 0, 0.8);
  border: 1px solid #333;
  border-radius: 0.25rem;
  overflow: hidden;
}

#energy-fill {
  height: 100%;
  background: linear-gradient(90deg, #00d2ff, var(--neon-blue));
  width: 100%;
  transition: width 0.1s linear;
  box-shadow: 0 0 10px var(--neon-blue);
}

/* DASH BUTTON HUD */
.dash-btn-wrapper {
  position: absolute;
  bottom: 2.5rem;
  /* Moved up a bit more to be clear of ground and distance */
  right: 1.5rem;
  width: 5rem;
  height: 5rem;
  display: none;
  /* Hidden by default */
  pointer-events: auto !important;
  /* Force clicks to pass through */
  z-index: 500;
}

/* Class to show button when setting is ON */
.has-dash-btn .dash-btn-wrapper {
  display: block;
}

.dash-button-hud {
  font-family: inherit;
  font-weight: 900;
  font-size: 0.8rem;
  width: 5rem;
  height: 5rem;
  border-radius: 50%;
  /* Circle shape! */
  background: rgba(0, 0, 0, 0.8);
  border: 4px solid var(--neon-blue);
  color: var(--neon-blue);
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.2s;
  letter-spacing: 2px;
  box-shadow: 0 0 15px rgba(0, 255, 247, 0.3);
  pointer-events: auto;
  user-select: none;
  touch-action: none;
}

.dash-button-hud:hover {
  background: var(--neon-blue);
  color: #000;
  box-shadow: 0 0 25px var(--neon-blue);
  transform: scale(1.05);
}

.dash-button-hud:active {
  transform: scale(0.9);
  box-shadow: 0 0 10px var(--neon-blue);
  background: #fff;
}

/* DASH BUTTON ACCENTS - 4 Corner Arcs */
.dash-btn-wrapper::before,
.dash-btn-wrapper::after {
  content: "";
  position: absolute;
  top: -12px;
  left: -12px;
  right: -12px;
  bottom: -12px;
  border-radius: 50%;
  pointer-events: none;
  border: 3px solid var(--neon-blue);
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  opacity: 0.8;
}

.dash-btn-wrapper::before {
  mask-image: conic-gradient(from 0deg,
      transparent 25deg,
      black 30deg, black 60deg,
      transparent 65deg, transparent 115deg,
      black 120deg, black 150deg,
      transparent 155deg, transparent 205deg,
      black 210deg, black 240deg,
      transparent 245deg, transparent 295deg,
      black 300deg, black 330deg,
      transparent 335deg);
  -webkit-mask-image: conic-gradient(from 0deg,
      transparent 25deg,
      black 30deg, black 60deg,
      transparent 65deg, transparent 115deg,
      black 120deg, black 150deg,
      transparent 155deg, transparent 205deg,
      black 210deg, black 240deg,
      transparent 245deg, transparent 295deg,
      black 300deg, black 330deg,
      transparent 335deg);
}

.dash-btn-wrapper::after {
  /* Offset by 45deg to get the corners or sides as preferred, but one element with complex mask is better */
  display: none;
  /* Consolidating into ::before for simplicity and performance */
}


.has-dash-btn:active .dash-btn-wrapper::before,
.has-dash-btn:active .dash-btn-wrapper::after {
  transform: scale(1.1);
  opacity: 0.5;
}

.dash-button-hud:disabled {
  opacity: 0.3;
  cursor: default;
  border-color: #555;
  color: #555;
  box-shadow: none;
}

/* MODALS BASE */
.modal-panel {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--panel-bg);
  border: 1px solid var(--neon-blue);
  border-radius: 1rem;
  display: none;
  pointer-events: auto;
  z-index: 1000;
  box-shadow: 0 0 100px rgba(0, 0, 0, 0.9);
  padding: 1.5rem 2rem;
  max-width: 95vw;
  max-height: 95vh;
  /* Flex layout for scrolling content */
  display: none;
  /* Override by .modal-active which sets display: flex */
  flex-direction: column;
}

.modal-active {
  display: flex !important;
  animation: zoomIn 0.3s ease-out;
}

/* Scrollable Content Area */
.settings-content,
.shop-main-layout {
  flex: 1;
  overflow-y: auto;
  margin: 1rem 0;
  padding-right: 0.5rem;
  /* Space for scrollbar if needed, but we hide it */
}

/* Hide Scrollbar */
.settings-content::-webkit-scrollbar,
.shop-main-layout::-webkit-scrollbar {
  display: none;
}

.settings-content,
.shop-main-layout {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Ensure Footer stays at bottom */
.modal-footer {
  flex-shrink: 0;
  margin-top: 0 !important;
  /* Remove top margin as handled by flex gap/margin */
  padding-top: 1rem;
}

@media (max-height: 500px) {
  .modal-panel {
    padding: 0.5rem 1rem;
    width: 90vw;
    height: 95vh;
  }

  h2 {
    font-size: 1.2rem;
    margin: 0.5rem 0;
  }

  .setting-row {
    margin-bottom: 0.5rem;
  }
}

@keyframes zoomIn {
  from {
    opacity: 0;
    transform: translate(-50%, -45%) scale(0.9);
  }

  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.close-modal {
  position: absolute;
  top: 0.75rem;
  right: 1.25rem;
  color: #555;
  cursor: pointer;
  font-size: 1.75rem;
  transition: 0.2s;
}

.close-modal:hover {
  color: var(--neon-red);
}

h2 {
  margin: 0.5rem 0 1.25rem;
  /* Reduced margins */
  text-align: center;
  color: var(--neon-blue);
  letter-spacing: 2px;
  font-weight: 900;
  text-shadow: 0 0 10px var(--neon-blue);
  font-size: 1.5rem;
  /* More compact size */
}

/* START SCREEN & MAP SELECTOR */
.screen-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  z-index: 50;
  transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#start-screen[style*="display: none"] {
  opacity: 0;
  transform: scale(0.95);
  display: flex !important;
  /* Keep it in DOM for transition */
  pointer-events: none;
  visibility: hidden;
}

#start-screen:not([style*="display: none"]) {
  opacity: 1;
  transform: scale(1);
  visibility: visible;
}

.map-selector-container {
  display: flex;
  gap: 1.5rem;
  margin-bottom: 2rem;
  pointer-events: auto;
}

.map-option {
  width: 4rem;
  height: 4rem;
  background: rgba(0, 0, 0, 0.7);
  border: 2px solid #333;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  cursor: pointer;
  transition: 0.3s;
}

.map-option:hover {
  border-color: var(--neon-blue);
  background: rgba(0, 255, 247, 0.05);
  /* Minimal tint */
  transform: translateY(-5px) scale(1.1);
  box-shadow: 0 0 8px var(--neon-blue);
  /* Reduced glow */
}

.map-option.active {
  border-color: var(--neon-blue);
  background: rgba(0, 0, 0, 0.9);
  /* Keep background dark! */
  box-shadow: 0 0 12px var(--neon-blue), inset 0 0 5px var(--neon-blue);
  /* Rim lighting */
  transform: translateY(-8px) scale(1.2);
}

.map-option.active img {
  filter: drop-shadow(0 0 8px rgba(0, 255, 247, 0.8));
  /* Glow effect instead of inversion */
}

.map-option img {
  transition: filter 0.3s;
}

/* SUNNY THEME OVERRIDES */
#start-screen[data-theme="sunny"] {
  background: rgba(165, 180, 252, 0.2);
}

#start-screen[data-theme="sunny"] .map-option {
  background: rgba(255, 255, 255, 0.4);
  border-color: rgba(255, 255, 255, 0.2);
}

#start-screen[data-theme="sunny"] #selected-theme-name {
  color: #fff;
  text-shadow: 0 0 20px #fff, 0 0 40px #6366f1;
}

#start-screen[data-theme="sunny"] .start-instruction {
  color: #1e1e1e;
  font-weight: 800;
}

#selected-theme-name {
  font-size: 3.5rem;
  font-weight: 900;
  color: var(--neon-blue);
  text-shadow: 0 0 25px var(--neon-blue);
  letter-spacing: 4px;
  margin-bottom: 0.5rem;
  text-transform: uppercase;
  transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.start-instruction {
  font-size: 1.2rem;
  color: #fff;
  letter-spacing: 3px;
  font-weight: 400;
  opacity: 0.8;
  animation: blink 1.5s infinite;
}

@keyframes blink {

  0%,
  100% {
    opacity: 0.3;
  }

  50% {
    opacity: 1;
  }
}

/* TUTORIAL GUIDE */
.tutorial-guide {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2rem;
  margin-top: 1.5rem;
  margin-bottom: 2.5rem;
  background: rgba(0, 10, 20, 0.85);
  padding: 1.2rem 3rem;
  border-radius: 2rem;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 30px rgba(0, 255, 247, 0.15), inset 0 0 20px rgba(0, 255, 247, 0.05);
  backdrop-filter: blur(10px);
}

.tut-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.8rem;
  min-width: 7rem;
}

.tut-icon {
  min-width: 4rem;
  height: 3.2rem;
  padding: 0 1rem;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.02) 100%);
  border: 2px solid var(--neon-blue);
  border-radius: 0.8rem;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1rem;
  font-weight: 900;
  color: var(--neon-blue);
  box-shadow: 0 4px 0 rgba(0, 210, 255, 0.5), 0 0 15px rgba(0, 255, 247, 0.2);
  /* Keycap 3D effect */
  text-shadow: 0 0 8px var(--neon-blue);
  animation: floatIcon 3s infinite ease-in-out;
  text-transform: uppercase;
  font-family: 'JetBrains Mono', monospace;
}

/* Mobile Touch Icon Specifics */
.tut-icon.touch-icon {
  background: transparent;
  border: 2px solid #fff;
  border-radius: 50%;
  width: 3.5rem;
  height: 3.5rem;
  min-width: 3.5rem;
  box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue);
  text-shadow: none;
  font-size: 1.8rem;
  padding: 0;
  animation: floatIcon 3s infinite ease-in-out, pulseTouch 2s infinite;
}

@keyframes pulseTouch {

  0%,
  100% {
    box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue);
  }

  50% {
    box-shadow: 0 0 35px var(--neon-blue), inset 0 0 20px var(--neon-blue);
  }
}

.tut-label {
  font-size: 0.75rem;
  font-weight: 800;
  color: #fff;
  letter-spacing: 2px;
  opacity: 0.9;
  text-transform: uppercase;
}

.tut-separator {
  width: 2px;
  height: 3.5rem;
  background: linear-gradient(to bottom, transparent, var(--neon-blue), transparent);
  opacity: 0.5;
}


/* Animation for floating icons */
@keyframes floatIcon {

  0%,
  100% {
    transform: translateY(0);
  }

  50% {
    transform: translateY(-5px);
  }
}


/* SHOP */
.full-shop {
  width: 50rem;
  max-width: 95vw;
  height: 36rem;
  max-height: 95vh;
  padding: 1.2rem;
}

.full-shop.modal-active {
  display: flex;
  flex-direction: column;
}

@media (max-height: 500px) {
  .full-shop {
    height: 95vh;
    padding: 0.75rem;
  }

  .shop-grid {
    height: 14rem;
    gap: 0.8rem;
  }

  .shop-tab {
    padding: 0.3rem 1rem;
    font-size: 0.7rem;
  }
}

.shop-tabs {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.shop-tab {
  padding: 0.5rem 2rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid #333;
  border-radius: 0.5rem;
  color: #888;
  font-weight: 800;
  font-size: 0.8rem;
  cursor: pointer;
  transition: 0.2s;
}

.shop-tab:hover {
  color: #fff;
  border-color: var(--neon-blue);
}

.shop-tab.active {
  background: var(--neon-blue);
  color: #000;
  border-color: var(--neon-blue);
  box-shadow: 0 0 15px var(--neon-blue);
}

.shop-main-layout {
  flex: 1;
  overflow-y: auto;
  scrollbar-width: none;
  padding: 0.2rem 0.5rem;
  margin-top: 0.5rem;
  height: 19rem;
  /* Fixed height to show roughly 2 rows */
}

.shop-main-layout::-webkit-scrollbar {
  display: none;
}

.shop-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.8rem;
}

.shop-balance {
  margin-bottom: 0.5rem;
  font-size: 0.8rem;
  color: var(--neon-gold);
  font-weight: 900;
  display: flex;
  justify-content: space-between;
}

.shop-grid::-webkit-scrollbar {
  display: none;
}

.skin-card {
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid #333;
  border-radius: 0.75rem;
  padding: 0.8rem;
  /* Slightly more compact */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  transition: 0.2s;
  position: relative;
}

.skin-card:hover {
  border-color: var(--neon-blue);
  background: rgba(0, 255, 247, 0.03);
}

.card-preview-box {
  height: 3.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transform: scale(1.1);
}

.card-preview-box canvas {
  background: transparent !important;
  /* Force transparency */
}

.card-name {
  font-size: 0.7rem;
  font-weight: 900;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
  height: 2rem;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.shop-card-btn {
  width: 100%;
  padding: 0.65rem 0;
  border: none;
  border-radius: 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 900;
  font-size: 0.75rem;
  cursor: pointer;
  transition: 0.2s;
  text-transform: uppercase;
  background: var(--neon-blue);
  color: #000;
}

.shop-card-btn:hover {
  background: #fff;
  transform: scale(1.03);
}

/* UNIFIED COLOR FOR ALL ACTION BUTTONS - Solid Blue */
.btn-primary,
.shop-card-btn.buy,
.shop-card-btn.equip,
.btn-outline {
  background: var(--neon-blue);
  color: #000;
  border: none;
}

/* PAGINATION */
.pagination-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
}

.page-btn {
  background: #222a35;
  border: none;
  border-radius: 0.4rem;
  color: #fff;
  min-width: 2.2rem;
  height: 2.2rem;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.8rem;
}

.page-btn:hover:not(:disabled) {
  background: #333d4d;
  color: var(--neon-blue);
}

.page-btn.active {
  background: var(--neon-blue);
  color: #000;
  box-shadow: 0 0 15px var(--neon-blue);
}

.page-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.page-dots {
  color: #555;
  padding: 0 0.5rem;
}

/* REVIVE BUTTON RE-DESIGN - Integrated Timer */
#reviveBtn {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 1.2rem;
  padding: 0.8rem 1.5rem;
  white-space: nowrap;
  position: relative;
  overflow: hidden;
  background: rgba(10, 10, 20, 0.9);
  border: 2px solid var(--neon-blue);
  border-radius: 0.5rem;
  color: var(--neon-blue);
  text-shadow: 0 0 10px var(--neon-blue);
  font-weight: 950;
  transition: all 0.3s ease;
  box-shadow: 0 0 20px rgba(0, 255, 247, 0.2);
  cursor: pointer;
}

/* Integrated Timebar (Pseudo-element) */
#reviveBtn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  background: var(--neon-blue);
  box-shadow: 0 0 25px var(--neon-blue);
  opacity: 0.55;
  /* Higher visibility */
  transform: scaleX(1);
  transform-origin: left;
  z-index: 1;
  pointer-events: none;
}

/* Receding effect: Right to Left */
#reviveBtn.timer-active::before {
  transform: scaleX(0);
  transition: transform 5s linear;
}

/* Trạng thái khi hết giờ */
#reviveBtn.revive-expired {
  background: #1a1a1a !important;
  border-color: #333 !important;
  color: #555 !important;
  text-shadow: none !important;
  pointer-events: none;
  opacity: 0.7;
  box-shadow: none;
}

#reviveBtn.revive-expired #revive-cost-tag {
  color: #555 !important;
  text-shadow: none !important;
}

/* Đảm bảo nội dung luôn hiển thị trên thanh năng lượng */
#reviveBtn span {
  position: relative;
  z-index: 5;
}

#revive-cost-tag {
  font-size: 0.95rem !important;
  color: var(--neon-gold);
  font-weight: 950;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.btn-outline {
  background: transparent;
  border: 1px solid var(--neon-blue);
  color: var(--neon-blue);
  padding: 0.8rem 1.5rem;
  border-radius: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 800;
  cursor: pointer;
  transition: 0.2s;
  text-transform: uppercase;
}

.btn-outline:hover {
  background: rgba(0, 255, 247, 0.1);
  box-shadow: 0 0 15px rgba(0, 255, 247, 0.3);
}

#reviveAdBtn.revive-expired {
  border-color: #333 !important;
  color: #555 !important;
  pointer-events: none;
  opacity: 0.6;
}

/* SHOP STATES */
.skin-card .equip {
  background: var(--grey-muted);
  color: #fff;
}

.skin-card .equipped {
  background: var(--neon-blue);
  color: #000;
  box-shadow: 0 0 15px var(--neon-blue);
  cursor: default;
}

.item-quantity {
  position: absolute;
  top: -0.5rem;
  right: -0.5rem;
  background: var(--neon-gold);
  color: #000;
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 900;
  box-shadow: 0 0 10px var(--neon-gold);
  z-index: 10;
}

.boost-card-actions {
  display: flex;
  flex-direction: row;
  gap: 0.4rem;
  width: 100%;
  margin-top: 0.5rem;
}

.shop-card-btn.buy {
  background: var(--neon-gold);
  color: #000;
  flex: 1;
}

.shop-card-btn.activate {
  background: #222;
  color: #888;
  border: 1px solid #444;
  flex: 1.2;
}

.quantity-input-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin: 0.2rem 0;
  width: 100%;
}

.qty-label {
  font-size: 0.6rem;
  color: #666;
}

.qty-input {
  width: 3rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid #333;
  border-radius: 0.3rem;
  color: #fff;
  text-align: center;
  font-family: inherit;
  font-size: 0.75rem;
  padding: 0.2rem;
}

.qty-input:focus {
  border-color: var(--neon-gold);
  outline: none;
}

.shop-card-btn.activate.can-activate {
  background: var(--neon-green);
  color: #000;
  border: none;
}

.shop-card-btn.activate.equipped {
  background: var(--neon-blue);
  color: #000;
}

/* TOOLTIP */
#custom-tooltip {
  position: absolute;
  display: none;
  background: rgba(0, 0, 0, 0.95);
  border: 1px solid var(--neon-blue);
  border-radius: 0.4rem;
  padding: 0.6rem 0.8rem;
  font-size: 0.7rem;
  color: #fff;
  max-width: 12rem;
  z-index: 2000;
  pointer-events: none;
  line-height: 1.4;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
}

/* SETTINGS (Balanced Rows) */
.compact-settings {
  width: 36rem;
  max-width: 90vw;
}

@media (max-height: 500px) {
  .setting-row {
    margin-bottom: 0.5rem;
    height: 1.8rem;
    gap: 1rem;
  }

  .setting-label {
    width: 7rem;
    font-size: 0.75rem;
  }
}

.setting-row {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 1rem;
  min-height: 2.2rem;
  /* Use min-height instead of fixed height */
}

.setting-label {
  width: 8rem;
  /* Slightly narrower */
  color: #aaa;
  font-size: 0.85rem;
  text-transform: uppercase;
  font-weight: 700;
  white-space: nowrap;
}

.btn-toggle.on {
  border-color: var(--neon-blue);
  color: var(--neon-blue);
  background: rgba(0, 255, 247, 0.1);
  box-shadow: 0 0 10px var(--neon-blue);
}

.btn-toggle.off {
  border-color: var(--grey-muted);
  color: var(--grey-muted);
}

.setting-row input[type="range"] {
  flex: 1;
  accent-color: var(--neon-blue);
  cursor: pointer;
}

.val-display {
  width: 3rem;
  color: var(--neon-blue);
  font-weight: 700;
  text-align: right;
  font-size: 0.85rem;
}

.btn-toggle {
  background: transparent;
  border: 2px solid var(--neon-blue);
  color: var(--neon-blue);
  width: 3.8rem;
  height: 2rem;
  border-radius: 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  font-weight: 900;
  cursor: pointer;
  transition: 0.2s;
}

.btn-toggle.off {
  border-color: var(--grey-muted);
  color: var(--grey-muted);
}

/* SETTINGS SELECTOR GROUP */
.selector-group {
  display: flex;
  flex: 1;
  gap: 0.6rem;
  margin-right: 0;
}

.selector-btn {
  background: #111 !important;
  border: 1px solid #333 !important;
  color: #666 !important;
  padding: 0.5rem 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  border-radius: 0.4rem;
}

.selector-btn.active {
  background: var(--neon-blue) !important;
  color: #000 !important;
  border-color: var(--neon-blue) !important;
  box-shadow: 0 0 15px var(--neon-blue);
  text-shadow: none;
}

.selector-btn:hover:not(.active) {
  border-color: #555 !important;
  color: #aaa !important;
}

/* Removed border-left fallback */

.selector-btn:not(.active):hover {
  color: #aaa !important;
  background: #333 !important;
}

.setting-label.mini {
  width: auto;
  margin-left: 0.5rem;
  font-size: 0.65rem;
  color: var(--neon-blue);
  /* Make it neon blue to be very visible */
  font-weight: 900;
  opacity: 0.8;
}

/* FPS DISPLAY IN HUD - Positioned under Settings */
.fps-text {
  position: absolute;
  top: 3.5rem;
  right: 1.1rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: rgba(0, 255, 247, 0.6);
  font-weight: 800;
  display: none;
  text-shadow: 0 0 5px var(--neon-blue);
}

#game-container.has-fps .fps-text {
  display: block;
}

/* CONFIRM POPUP */
.confirm-dialog {
  width: 28rem;
  text-align: center;
}

.security-alert {
  border-color: var(--neon-red);
  box-shadow: 0 0 40px rgba(255, 51, 51, 0.3);
}

.security-alert #security-ok:hover {
  background: rgba(255, 51, 51, 0.1);
  box-shadow: 0 0 15px var(--neon-red);
}

.modal-footer {
  display: flex;
  justify-content: center;
  gap: 1.25rem;
}

.btn-secondary {
  background: transparent;
  border: 2px solid var(--neon-blue);
  color: var(--neon-blue);
  padding: 0.75rem 2rem;
  border-radius: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 900;
  cursor: pointer;
  transition: 0.2s;
}

.btn-secondary:hover {
  background: rgba(0, 255, 247, 0.1);
}

.btn-primary {
  background: transparent;
  border: 2px solid var(--neon-blue);
  color: var(--neon-blue);
  padding: 0.75rem 2.5rem;
  border-radius: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 900;
  cursor: pointer;
  transition: 0.2s;
}

.btn-primary:hover {
  background: rgba(0, 255, 247, 0.1);
  box-shadow: 0 0 15px var(--neon-blue);
}

.version-tag {
  position: absolute;
  bottom: 0.75rem;
  right: 1.25rem;
  font-size: 0.65rem;
  color: #555;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  pointer-events: none;
}

/* GAME OVER */
/* GAME OVER POPUP */
.game-over-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  z-index: 2000;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

.game-over-popup {
  background: rgba(10, 10, 20, 0.95);
  border: 2px solid var(--neon-red);
  border-radius: 1.5rem;
  padding: 1.5rem 2.5rem;
  /* More compact padding */
  text-align: center;
  box-shadow: 0 0 60px rgba(255, 51, 51, 0.25), inset 0 0 20px rgba(255, 51, 51, 0.1);
  animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), shake 0.5s ease-in-out 0.4s;
  max-width: 90vw;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }

  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes shake {

  0%,
  100% {
    transform: translateX(0);
  }

  20% {
    transform: translateX(-10px) rotate(-2deg);
  }

  40% {
    transform: translateX(10px) rotate(2deg);
  }

  60% {
    transform: translateX(-6px) rotate(-1deg);
  }

  80% {
    transform: translateX(6px) rotate(1deg);
  }
}

.game-over-header {
  font-size: 2.8rem;
  /* Slightly smaller header */
  color: var(--neon-red);
  text-shadow: 0 0 20px var(--neon-red);
  font-weight: 950;
  margin-bottom: 1.5rem;
  /* Reduced margin */
  letter-spacing: 6px;
  background: linear-gradient(180deg, #fff, var(--neon-red));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.simple-stats {
  margin-bottom: 1.5rem;
  /* Reduced margin */
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  /* Tighter gaps for 4 rows */
}

.simple-stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 4rem;
  padding-bottom: 0.2rem;
}

.simple-stat-row .label {
  font-size: 0.9rem;
  color: #888;
  font-weight: 700;
  letter-spacing: 2px;
}

.simple-stat-row .value {
  font-size: 2rem;
  color: #fff;
  font-weight: 900;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}

.game-over-popup #restartBtn {
  background: transparent;
  border: 2px solid var(--neon-red);
  color: var(--neon-red);
  box-shadow: 0 0 15px rgba(255, 51, 51, 0.2);
}

.game-over-popup #restartBtn:hover {
  background: var(--neon-red);
  color: #000;
  box-shadow: 0 0 30px var(--neon-red);
}

@media (max-height: 500px) {
  .game-over-popup {
    padding: 1.2rem 2rem;
  }

  .game-over-header {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    letter-spacing: 3px;
  }

  .simple-stats {
    margin-bottom: 1.2rem;
    gap: 0.6rem;
  }

  .simple-stat-row {
    gap: 2rem;
  }

  .simple-stat-row .value {
    font-size: 1.4rem;
  }

  .simple-stat-row .label {
    font-size: 0.7rem;
  }

  #selected-theme-name {
    font-size: 2.2rem;
  }

  .map-option {
    width: 3rem;
    height: 3rem;
    font-size: 1.2rem;
  }

  .map-selector-container {
    margin-bottom: 1rem;
    gap: 1rem;
  }

  .start-instruction {
    font-size: 0.9rem;
  }
}

/* BONUS POPUP */
.bonus-popup {
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background: rgba(0, 0, 0, 0.9);
  border: 2px solid var(--neon-gold);
  border-radius: 1rem;
  padding: 1.5rem 3rem;
  text-align: center;
  opacity: 0;
  pointer-events: none;
  transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  z-index: 2000;
  box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  white-space: nowrap;
}

.bonus-popup {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  opacity: 0;
  pointer-events: none;
  background: rgba(0, 0, 0, 0.95);
  padding: 1.5rem 3rem;
  border: 2px solid var(--neon-gold);
  z-index: 2000;
  box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  white-space: nowrap;
  visibility: hidden;
  /* Prevent flicker at start */
}

.bonus-popup.active {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  visibility: visible;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.bonus-amount {
  color: var(--neon-gold);
  font-size: 1.8rem;
  font-weight: 900;
  text-shadow: 0 0 15px var(--neon-gold);
}

/* SPLASH SCREEN */
#splash-screen {
  background: url('/menu_bg.jpg') no-repeat center center;
  background-size: cover;
  transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.8s;
  display: flex !important;
  opacity: 0;
  pointer-events: none;
  visibility: hidden;
  z-index: 5000;
  transform: scale(1);
}

#splash-screen.splash-active {
  opacity: 1;
  pointer-events: auto;
  visibility: visible;
  transform: scale(1);
}

/* Exit animation for splash screen */
#splash-screen:not(.splash-active) {
  opacity: 0;
  transform: scale(1.1);
  /* Slight zoom out effect on exit */
  pointer-events: none;
}

/* Hide HUD when splash is active */
#splash-screen.splash-active~#main-hud {
  display: none !important;
}

.splash-content {
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  transform: translateY(-4rem);
  /* CHANGE THIS VALUE to adjust vertical position. E.g: 0 for center, -10rem for higher, 5rem for lower. */
}

.main-play-btn {
  font-size: 2.2rem;
  padding: 1rem 6rem;
  background: rgba(0, 0, 0, 0.6);
  border: 4px solid var(--neon-blue);
  /* Neon Border */
  color: var(--neon-blue);
  /* Neon Text */
  font-weight: 950;
  cursor: pointer;
  letter-spacing: 15px;
  position: relative;
  transition: 0.3s all;
  box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue);
  /* Neon Glow */
  text-shadow: 0 0 10px var(--neon-blue);
  clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
  text-indent: 15px;
  margin-right: 5rem;
  /* Moved left as requested */
  overflow: hidden;
  /* For sweep effect */
}

/* RETRO SCANLINE SWEEP EFFECT */
.main-play-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      rgba(255, 255, 255, 0.4),
      rgba(255, 255, 255, 0.1),
      transparent);
  transition: 0.5s;
}

.main-play-btn:hover::after {
  left: 100%;
  transition: 0.7s;
}

/* NEON RUNNING BORDER ON HOVER */
.main-play-btn:hover {
  background: #000;
  color: #fff;
  border-color: var(--neon-blue);
  box-shadow: 0 0 30px var(--neon-blue);
  transform: scale(1.05);
  text-shadow: 0 0 10px var(--neon-blue);
}

.main-play-btn:active {
  transform: scale(0.95);
}

/* CENTRAL NOTIFICATION POPUP */
/* CENTRAL NOTIFICATION POPUP */
.notification-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.notification-popup.show {
  opacity: 1;
}

.notification-content {
  background: rgba(0, 0, 0, 0.95);
  border: 2px solid var(--neon-blue);
  border-radius: 1rem;
  padding: 2rem 3rem;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 1.5rem;
  box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), 0 0 20px var(--neon-blue);
  transform: scale(0.8);
  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.notification-popup.show .notification-content {
  transform: scale(1);
}

.notification-popup.error .notification-content {
  border-color: var(--neon-red);
  box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), 0 0 20px var(--neon-red);
}

.notif-text {
  font-size: 1.2rem;
  font-weight: 900;
  color: #fff;
  text-align: left;
  text-transform: uppercase;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
}

#notif-icon {
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#notif-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
}